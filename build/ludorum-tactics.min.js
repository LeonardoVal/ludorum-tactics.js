//! ludorum-tactics 0.0.1

!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","ludorum"],b):"object"==typeof module&&module.exports?module.exports=b(require("creatartis-base"),require("ludorum")):a.ludorum_gamepack=b(a.base,a.ludorum)}(this,function a(b,c){"use strict";var d=b.declare,e=b.iterable,f=b.initialize,g=c.Game,h=b.raiseIf,i={__name__:"ludorum-tactics",__init__:a,__dependencies__:[b,c]};i.TacticsPiece=d({constructor:function(a){f(this,a).string("owner").array("position",{length:2,elementType:b.types.INTEGER}).integer("movement",{defaultValue:1,minimum:1,maximum:4}).integer("hp").integer("damage",{defaultValue:0}).number("attackChance",{ignore:!0,minimum:0,maximum:1}).number("attackDamage",{ignore:!0,minimum:1}).number("attackRange",{ignore:!0,minimum:1,maximum:3}).number("defenseChance",{ignore:!0,minimum:0,maximum:1})},attackChance:.5,attackDamage:10,attackRange:4,defenseChance:.3,clone:function(){return new this.constructor(this)},isDestroyed:function(){return this.hp<=this.damageReceived},moves:function(a){for(var b,c,d,f,g,h={},i=[this.position],j=0;j<=this.movement;j++)b=i,i=[],b.forEach(function(b){b in h||(h[b]=b,c=[b[0],b[1]+1],d=[b[0]-1,b[1]],f=[b[0]+1,b[1]],g=[b[0],b[1]-1],[c,d,f,g].forEach(function(b){a.isPassable(b)&&i.push(b)}))});return e(h).select(1).toArray()},moveTo:function(a){var b=this.clone();return b.position=a,b},BresenhamLineAlgorithm:function(a,b){var c=this.position[0],d=this.position[1],e=b.position[0],f=b.position[1],g=Math.abs(e-c),h=e>c?1:-1,i=Math.abs(f-d);if(1>=g&&1>=i)return!0;for(var j=f>d?1:-1,k=(g>i?g:-i)/2;;){if(a.noViewTerrains.search(-1==a.terrain.square([c,d])))return!1;if(c===e&&d===f)break;var l=k;l>-g&&(k-=i,c+=h),i>l&&(k+=g,d+=j)}return!0},pieceInLineOfSight:function(a,b){return this.inLineOfSight(a,b.position)},inLineOfSight:function(a,b){return!0},possibleAttacks:function(a){var b=this;return a.pieces.filter(function(c){if(c.owner!=b.owner){var d=Math.sqrt(Math.pow(b.position[0]-c.position[0],2)+Math.pow(b.position[1]-piec.position[1],2));return d<=b.attackRange&&b.pieceInLineOfSight(a,c)}return!1})},attack:function(a){return a=a.clone(),a.damageReceived+=this.damage*this.hitChance*(1-a.saveChance),a}}),i.TacticsGame=d(g,{name:"TacticsGame",players:["Left","Right"],constructor:function(a,b,c){g.call(this,a[0|b].owner),this.pieces=a,this.currentPiece=0|b,this.hasMoved=!!c,this.__piecesByPosition__=e(a).map(function(a){return[a.position+"",a]}).toObject()},terrain:new c.utils.CheckerboardFromString(10,15,"...x..............x.....o............xxo..............#..............#.......oo#............oox..................oox........xx..................#....."),isPassable:function(a){return".x".indexOf(this.terrain.square(a))>=0&&!this.__piecesByPosition__[a+""]},isClear:function(a){return".o".indexOf(this.terrain.square(a))>=0},moves:function(){if(!this.hasOwnProperty("__moves__")){var a=this.pieces[this.currentPiece];a&&!this.result()?this.hasMoved?this.__moves__=a.possibleAttacks(this):this.__moves__=a.moves(this):this.__moves__=null}return this.__moves__},next:function(a){var b=this.pieces[this.currentPiece],c=this.pieces.concat([]);if(h(!a.hasOwnProperty(b.owner),"Active player has no moves in ",JSON.stringify(a),"!"),this.hasMoved){var d=a[b.owner],e=this.pieces[d],f=b.attack(e);return f.isDestroyed()?(d<this.currentPiece&&this.currentPiece--,c.splice(d,1)):c[d]=f,new this.constructor(c,(this.currentPiece+1)%this.pieces.length,!1)}return c[b]=b.moveTo(a[b.owner]),new this.constructor(c,this.currentPiece,!0)},result:function(){var a=this,b=e(this.players).map(function(b){var c=a.pieces.filter(function(a){return a.owner===b}).length;return[b,c]}).toObject();return b.Left<1?this.victory("Right",b.Right):b.Right<1?this.victory("Left",b.Left):null}});return i});
//# sourceMappingURL=ludorum-tactics.min.js.map